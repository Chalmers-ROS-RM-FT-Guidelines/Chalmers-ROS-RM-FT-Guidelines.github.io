<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


  <link href="../files/css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="../files/css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Verification of ROS-based Systems: Guidelines for Developers and QA Teams</title>
  <meta name="description" content="">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="generator" content="Hugo 0.57.2">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Verification of ROS-based Systems">
  <meta property="og:description" content="">
  <meta property="og:type" content="website">
  <meta property="og:url" content="-">
  <link rel="stylesheet" href="../files/styles.css">
  <link rel="stylesheet" href="../files/css">
  <link rel="stylesheet" href="../files/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">




  <link href="-index.xml" rel="alternate" type="application/rss+xml">



  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

  <script id="MathJax-script" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML"></script>

  <script id="MathJax-script" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML">

      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          autoload: {
            color: [],
            colorv2: ['color']
          },
          displayMath: [['$$', '$$']],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"], packages: { '[+]': ['noerrors'] }
          }
        }
      });
      MathJax.Hub.Queue(function () {



        var all = MathJax.Hub.getAllJax(), i;
        for (i = 0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });

      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }

      });


      MathJax.Hub.Register.MessageHook("Math Processing Error", function (message) {
        //  do something with the error.  message[2] is the Error object that records the problem.
      });


    </script>


  <style>
    code.has-jax {
      font: inherit;
      font-size: 100%;
      background: inherit;
      border: inherit;
      color: #515151;
    }


    .patternformulae {
      display: block;
      margin-left: auto;
      margin-right: auto;
      padding: 70px;
      width: 90%;
    }
  </style>
  <style id="fit-vids-style">
    .fluid-width-video-wrapper {
      width: 100%;
      position: relative;
      padding: 0;
    }

    .fluid-width-video-wrapper iframe,
    .fluid-width-video-wrapper object,
    .fluid-width-video-wrapper embed {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
  <style type="text/css">
    .MathJax_Hover_Frame {
      border-radius: .25em;
      -webkit-border-radius: .25em;
      -moz-border-radius: .25em;
      -khtml-border-radius: .25em;
      box-shadow: 0px 0px 15px #83A;
      -webkit-box-shadow: 0px 0px 15px #83A;
      -moz-box-shadow: 0px 0px 15px #83A;
      -khtml-box-shadow: 0px 0px 15px #83A;
      border: 1px solid #A6D ! important;
      display: inline-block;
      position: absolute
    }
  </style>
</head>

<body>
  <div id="MathJax_Message" style="display: none;"></div>

  <script type="application/javascript">
    var doNotTrack = false;
    if (!doNotTrack) {
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-33213501-2', 'auto');

      ga('send', 'pageview');
    }
  </script>


  <header class="site-header">
    <div class="container">
      <div class="titlespan">
        <div class="perspective-text">
          <div class="perspective-line">
            <p class="paragraph"></p>
            <p class="paragraph">Verification</p>
          </div>
          <div class="perspective-line">
            <p class="paragraph">Verification</p>
            <p class="paragraph">of</p>
          </div>
          <div class="perspective-line">
            <p class="paragraph">of</p>
            <p class="paragraph">ROS-based</p>
          </div>
          <div class="perspective-line">
            <p class="paragraph">ROS-based</p>
            <p class="paragraph">Systems</p>
          </div>
          <div class="perspective-line">
            <p class="paragraph">Systems</p>
            <p></p>
          </div>
        </div>
      </div>
    </div>

    <ul class="site-nav">
      <li class="site-nav-item">
        <a title="Guideline Catalog" href="https://ros-rvft.github.io/index">Guideline Catalog</a>
      </li>

      <li class="site-nav-item">
        <a title="Research" href="https://ros-rvft.github.io/research">Research</a>
      </li>

      <li class="site-nav-item">
        <a title="Replication package"
            href="https://github.com/SchiopuMatei/Chalmers-ROS-RM-FT-Datamining">Replication package</a>
    </li>

      <li class="site-nav-item">
        <a title="Evaluation" href="https://ros-rvft.github.io/evaluation">Evaluation</a>
      </li>

      <li class="site-nav-item">
        <a title="Contribute" href="https://ros-rvft.github.io/contribute">Contribute</a>
      </li>

      <li class="site-nav-item">
        <a title="Authors" href="https://ros-rvft.github.io/authors">Authors</a>
      </li>
    </ul>
    </div>



    <!-- ---------------------------------- CONTENT ---------------------------------- -->

  </header>
  <!-- ---------------------------------- GUIDELINE HEADER ---------------------------------- -->
  <div class="container">
    <article class="post-container">
      <header class="post-header">
        <h1 class="post-title">CD2. Ensure global time monotonicity of events and states</h1>

      </header>


      <div class="post-content clearfix">


        <h2 id="intent">Context (WHEN)</h2>

        <blockquote>
          <p>As distributed systems, such as ROS-based applications, rely on time scheduling for their operation, ensuring time monotonicity is crucial to guarantee the replicability and reproducibility of test cases. Non-determinism in the scheduling of events can lead to unexpected behavior, compromising the reliability of tests and hindering their reproduction. To address this issue, developers must ensure that the testing team is aware of the expected behavior given the occurrence of events, which requires establishing a clear execution order and priority. For instance, by synchronizing different types of data at package or subscription-level</p>
        </blockquote>



        <pre class="cpp"
          style="font-family:monospace;"><ol><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">    def instrument_launch_files<span style="color: #008000;">&#40;</span>nodes<span style="color: #008000;">&#41;</span><span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">        ...</div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">        <span style="color: #0000ff;">for</span> <span style="color: #008000;">&#40;</span>name, package, topics<span style="color: #008000;">&#41;</span> in launch_files<span style="color: #008000;">&#91;</span>path<span style="color: #008000;">&#93;</span><span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">            <span style="color: #0000ff;">if</span> node.<span style="color: #007788;">get</span><span style="color: #008000;">&#40;</span>’name’<span style="color: #008000;">&#41;</span> <span style="color: #000080;">==</span> name <span style="color: #0000ff;">and</span> node.<span style="color: #007788;">get</span><span style="color: #008000;">&#40;</span>’pkg</div></li><li style="font-weight: bold; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                ’<span style="color: #008000;">&#41;</span> <span style="color: #000080;">==</span> package<span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                <span style="color: #0000ff;">for</span> topic in topics<span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap <span style="color: #000080;">=</span> ET.<span style="color: #007788;">SubElement</span><span style="color: #008000;">&#40;</span>node, ’remap’<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap.<span style="color: #007788;">set</span><span style="color: #008000;">&#40;</span>’from’, topic<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap.<span style="color: #007788;">set</span><span style="color: #008000;">&#40;</span>’to’, topic <span style="color: #000040;">+</span> ’_mon’<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: bold; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                <span style="color: #0000ff;">break</span></div></li></ol></pre>


        <h2 id="relationships"> Reason (WHY)</h2>
        <p>Ensuring global time monotonicity of events and states permits to address the potential non-determinism in the scheduling of events in ROS-based applications. </p>

        <h2 id="occurences">Suggestion (WHAT)</h2>

        <p>The development team should ensure global time monotonicity of events and states to avoid potential non-determinism in scheduling. Such non-determinism is a threat to getting confidence in the system since repeated tests under the same conditions may turn into different results. A technique that can be used to ensure determinism is annotating messages and requests with timestamps and implementing a logical time synchronizer, similar to what is done by MAVROS (git: mavlink/mavros). Also, the Time Synchronizer message filter (wiki: message\_filters) may be used for this purpose.</p>


        <h2>Process (HOW)</h2>

        <p>Events are said to be monotonic in time whenever for a set of events scheduled over a global clock, two consecutive events are successive. First the developers should understand how events are scheduled and the limitations of the application towards predictable ordering of events. Then, the developers should analyze and guarantee that all processes are executed in the expected order and will lead to predictable behavior. Developers may accomplish such analysis and guarantee provision with external tools, for instance, formal methods or by embedding timestamps (e.g., SteadyTime) and filtering messages to guarantee ordered events (e.g., MAVROS). </p>



        <h2>Exemplars</h2>
        <h4 style="text-indent: 25px;">Understand the scheduling of ROS events and states</h4>

        <p>
          Chaaban K. explains that ROS 2 schedules callbacks using a non-preemptive algorithm that consumes messages depending on their type. Unlike typical real-time priority-based scheduling algorithms, ROS 2 does not execute callbacks in their activation instances. Thus non-time-based messages are scheduled in a round-robin fashion. To this extent, ROS 2 (which claims to address real-time) presents limitations when asked for well-defined execution orders and priority inversion. Choi et al. promotes a new scheduling algorithm that adds priority awareness for scheduling in ROS2. 
        </p>


        <h4 style="text-indent: 25px;">Analyse starvation-freedom to support monotonicity</h4>

        <p>
          Bla T. et al. proposes a response-time analysis exploiting the round-robin properties. The authors present an analysis of starvation-freedom using three techniques: modeling processor demand as execution-time curves instead of scalar worst-case execution times (WCETs), accounting for the effects of quiet times and busy windows in the activation curve derivation, and exploiting the round-robin behavior of the ROS callback scheduler. Starvation freedom indicates monotonicity and ordering of events, it helps the developers to understand real-time behavior and set expectations.
        </p>

        <p>
          Halder R. et. al use model checking (e.g., UPPAAL) to analyze real-time behavior in ROS-based applications. Under the claim that ROS non-deterministically empties the communication queues, the authors focus on modeling the message-passing behavior of ROS and verifying whether the queue overflows. Since overflow here means that some process is starving, thus the application is not monotonic in time. The authors offer the models in timed automata and TCTL (Temporal Computational Tree Logic) properties designed to ensure real-time for the safety controller of the Kobuki exemplar. 
        </p>

        <h4 style="text-indent: 25px;">Annotating messages with timestamps and synchronization to guarantee ordering</h4>

        <p>
          The SteadyTime class in ROS represents a monotonic clock, functioning independently of physical time and with steady tick times. MAVROS, a library broadly used in ArduPilot
for flight control, approaches time monotonicity guarantees by implementing a logical time synchronizer. The synchronizer ensures that the time passing in MAVROS is aligned with the time on ArduPilot's side, avoiding drifts that could lead the application to fail. More importantly, the time synchronizer uses a particular type of message that embeds timestamps for clock synchronization for updating ArduPilot about its time status. Messages such as this can be used for synchronizing the occurrence of events in the system.
        </p>


        <p class="strengths" style="text-indent: 25px;">Strengths:</p>
        <p>Tests reliability increases by enabling the prediction of the expected behavior of a system under scrutiny. In addition, time monotonicity guarantees can facilitate reproducing test results by establishing a clear execution order and priority. Finally, developers can reduce the time taken and resources used to verify the system behavior by implementing time synchronization and annotation messages with timestamps</p>


        <p class="weaknesses" style="text-indent: 25px;">Weaknesses:</p>
        <p> Implementing time synchronization to ensure time monotonicity may require additional development effort, adding complexity to the system. Also, time synchronization may add performance overhead due to additional operations execution. Achieving real-time behavior depends on the (interaction with the) operating system.
        </p>




          <!-- ---------------------------------- GUIDELINE CONTENT END ---------------------------------- -->


        </div>

      </div>

      <footer class="post-footer clearfix">


        <div class="share">




        </div>

  </div>
  <footer class="footer">
    <div class="container">
      <div class="site-title-wrapper">
        <h1 class="site-title">
          <a title="VERIFICATION OF ROS-BASED SYSTEMS" href="-">VERIFICATION OF ROS-BASED SYSTEMS</a>
        </h1>

      </div>

      <p class="footer-copyright">
        <span>Ricardo Caldas, Juan Antonio Pinera Garcia, Matei Schiopu,
          Patrizio Pelliccione, Genaina Rodrigues, and Thorsten Berger © 2024 </span>
      </p>
      <p class="footer-copyright">


      </p>
    </div>
  </footer>

  <script src="../files/jquery-1.11.3.min.js.download"></script>
  <script src="../files/jquery.fitvids.js.download"></script>
  <script src="../files/highlight.min.js.download"></script>
  <script src="../files/scripts.js.download"></script>


</body>

</html>