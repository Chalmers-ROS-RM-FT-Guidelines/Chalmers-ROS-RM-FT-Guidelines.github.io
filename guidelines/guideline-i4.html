<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


  <link href="../files/css/shCore.css" rel="stylesheet" type="text/css" />
  <link href="../files/css/shThemeDefault.css" rel="stylesheet" type="text/css" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>ros-rvft: guidelines for developers and qa teams</title>
  <meta name="description" content="">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="generator" content="Hugo 0.57.2">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Verification of ROS-based Systems">
  <meta property="og:description" content="">
  <meta property="og:type" content="website">
  <meta property="og:url" content="-">
  <link rel="stylesheet" href="../files/styles.css">
  <link rel="stylesheet" href="../files/css">
  <link rel="stylesheet" href="../files/font-awesome.min.css"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">




  <link href="-index.xml" rel="alternate" type="application/rss+xml">



  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

  <script id="MathJax-script" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML"></script>

  <script id="MathJax-script" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_HTML">

      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          autoload: {
            color: [],
            colorv2: ['color']
          },
          displayMath: [['$$', '$$']],
          processEscapes: true,
          processEnvironments: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"], packages: { '[+]': ['noerrors'] }
          }
        }
      });
      MathJax.Hub.Queue(function () {



        var all = MathJax.Hub.getAllJax(), i;
        for (i = 0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });

      MathJax.Hub.Config({
        TeX: { equationNumbers: { autoNumber: "AMS" } }

      });


      MathJax.Hub.Register.MessageHook("Math Processing Error", function (message) {
        //  do something with the error.  message[2] is the Error object that records the problem.
      });


    </script>


  <style>
    code.has-jax {
      font: inherit;
      font-size: 100%;
      background: inherit;
      border: inherit;
      color: #515151;
    }


    .patternformulae {
      display: block;
      margin-left: auto;
      margin-right: auto;
      padding: 70px;
      width: 90%;
    }
  </style>
  <style id="fit-vids-style">
    .fluid-width-video-wrapper {
      width: 100%;
      position: relative;
      padding: 0;
    }

    .fluid-width-video-wrapper iframe,
    .fluid-width-video-wrapper object,
    .fluid-width-video-wrapper embed {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
  <style type="text/css">
    .MathJax_Hover_Frame {
      border-radius: .25em;
      -webkit-border-radius: .25em;
      -moz-border-radius: .25em;
      -khtml-border-radius: .25em;
      box-shadow: 0px 0px 15px #83A;
      -webkit-box-shadow: 0px 0px 15px #83A;
      -moz-box-shadow: 0px 0px 15px #83A;
      -khtml-box-shadow: 0px 0px 15px #83A;
      border: 1px solid #A6D ! important;
      display: inline-block;
      position: absolute
    }
  </style>
</head>

<body>
  <div id="MathJax_Message" style="display: none;"></div>

  <script type="application/javascript">
    var doNotTrack = false;
    if (!doNotTrack) {
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-33213501-2', 'auto');

      ga('send', 'pageview');
    }
  </script>


  <header class="site-header">
    

    <ul class="site-nav">

      <li class="site-nav-item">
          <a title="Guideline Catalog" href="https://ros-rvft.github.io/index">Guideline
              Catalog</a>
      </li>

      <li class="site-nav-item">
          <a title="Replication package"
              href="https://ros-rvft.github.io/replication">Replication Package</a>
      </li>

      <li class="site-nav-item">
          <a title="Evaluation" href="https://ros-rvft.github.io/evaluation">Evaluation</a>
      </li>

      <li class="site-nav-item">
          <a title="Contribute" href="https://ros-rvft.github.io/contribute">Contribute</a>
      </li>

      <li class="site-nav-item">
          <a title="Authors" href="https://ros-rvft.github.io/authors">Authors</a>
      </li>

      <li class="site-nav-item">
          <a title="Research" href="https://ros-rvft.github.io/research">Cite Us!</a>
      </li>

  </ul>
    </div>



    <!-- ---------------------------------- CONTENT ---------------------------------- -->

  </header>
  <!-- ---------------------------------- GUIDELINE HEADER ---------------------------------- -->
  <div class="container">
    <article class="post-container">
      <header class="post-header">
        <h1 class="post-title">I4. Isolate components for testing</h1>

        <p class="post-description">Isolation of components
          to enable field-based testing while avoiding the crash of the system.</p>

      </header>


      <div class="post-content clearfix">


        <h2 id="intent">Context (WHEN)</h2>

        <blockquote>
          <p>Robotics applications require to be safely field tested with warrantied no side effects on the running system or the environment, including personnel. To this end, it is fundamental to pursue isolation of the components being tested. </p>
        </blockquote>

        <p>Man-in-the-Middle (MITM) can provide isolation of computing nodes for testing, which, as stated by Bertolino et al [1], can guarantee that the execution of the field tests does not interfere with the operation of the tested system. In addition, MITM nodes promotes the ability to drop or modifying internal signals improving the controllability of events and states, which as described by [2], refers to the degree to which a certain specification can be enforced on the system.</p>


        <pre class="cpp"
          style="font-family:monospace;"><ol><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">    def instrument_launch_files<span style="color: #008000;">&#40;</span>nodes<span style="color: #008000;">&#41;</span><span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">        ...</div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">        <span style="color: #0000ff;">for</span> <span style="color: #008000;">&#40;</span>name, package, topics<span style="color: #008000;">&#41;</span> in launch_files<span style="color: #008000;">&#91;</span>path<span style="color: #008000;">&#93;</span><span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">            <span style="color: #0000ff;">if</span> node.<span style="color: #007788;">get</span><span style="color: #008000;">&#40;</span>’name’<span style="color: #008000;">&#41;</span> <span style="color: #000080;">==</span> name <span style="color: #0000ff;">and</span> node.<span style="color: #007788;">get</span><span style="color: #008000;">&#40;</span>’pkg</div></li><li style="font-weight: bold; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                ’<span style="color: #008000;">&#41;</span> <span style="color: #000080;">==</span> package<span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                <span style="color: #0000ff;">for</span> topic in topics<span style="color: #008080;">:</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap <span style="color: #000080;">=</span> ET.<span style="color: #007788;">SubElement</span><span style="color: #008000;">&#40;</span>node, ’remap’<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap.<span style="color: #007788;">set</span><span style="color: #008000;">&#40;</span>’from’, topic<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: normal; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                    remap.<span style="color: #007788;">set</span><span style="color: #008000;">&#40;</span>’to’, topic <span style="color: #000040;">+</span> ’_mon’<span style="color: #008000;">&#41;</span></div></li><li style="font-weight: bold; vertical-align:top;"><div style="font: normal normal 1em/1.2em monospace; margin:0; padding:0; background:none; vertical-align:top;">                <span style="color: #0000ff;">break</span></div></li></ol></pre>


        <h2 id="relationships"> Reason (WHY)</h2>
        <p>The ROS ecosystem does not provide a native mechanism for node isolation. The MITM node strategy can be a
          powerful and flexible design pattern to isolate computing nodes in ROS-based systems. It allows for increased
          visibility into the system's operation, more flexible communication between nodes, and improved reliability
          and security.</p>

        <h2 id="occurences">Suggestion (WHAT)</h2>

        <p>Isolation of components is an important feature to enable field-based testing (by following the “let it crash” philosophy introduced by Netflix web:chaos-monkey) while avoiding the crash of the system. Isolation permits catching immediately the component that is crashing and executing countermeasures to keep the system up. Examples of solutions for isolation are: (i) the use of proxy nodes of ROSRV (git: cansuerdogan/ROSRV), or (ii) introducing intermediary nodes between original nodes by exploiting the topic remapping functionality (wiki: remap) of ROSMonitoring (git: autonomy-and-verification-uol/ROSMonitoring), which enables swapping topic names just before running the application. </p>


        <h2>Process (HOW)</h2>

        <p>In ROS, the man-in-the-middle (MITM) strategy consists of introducing intermediary ROS nodes between components, in this context the term ‘components’ stands for one or more ROS nodes presenting unique functionality and welldefined interfaces. Such intermediary nodes may react by blocking, dropping, modifying, or inspecting the messages passed between components. We identified two means of enacting MITM in ROS, through a proxy design pattern, e.g., ROSRV [3], or through topic remapping, e.g. ROSMonitoring [4]. The former works by generating a proxy-based of the ROS Master node which has full control of the nodes and topics during runtime, deploying an intermediary node for 1 message diverting when required. The latter launches an intermediary node and performs topic remapping before execution – asking for the topic names that should be diverted. </p>



        <h2>Exemplars</h2>
        <h4 style="text-indent: 25px;">Proxy</h4>

        <p>
          ROSRV <a href="https://github.com/cansuerdogan/ROSRV/tree/master/src/RVMaster"> (ROSRV)</a> [3] deploys a ROS master node proxy, namely RVMaster , that acts as a firewall, blocking the access to the ROS master node port. This node, in turn, is responsible for creating MITM nodes (also called monitors) that intercept the messages flowing between nodes in the system. RVMaster instantiates the MITM nodes according to user-provided specifications of access policies, even though it does not require any change to the system under scrutiny. Listing 1 portrays the createInterceptors () method from the RVMaster that enacts MITM monitor nodes by re-subscribing to a new set of topics. 
        </p>


        <p>Listing 1: Creating proxy-based MITM nodes in ROSRV. </p>
        
        <blockquote>
        <p>
        1 void ServerManager::createInterceptors(){ 2 3 for (std::map<std::string,std::string>::iterator it=rv::monitor:: topicsAndTypes.begin(); it!=rv::monitor::topicsAndTypes.end(); ++it) { 4 string topic = it->first; 5 string datatype = it->second; 6 Monitor *monitor_p = NULL; 7 string monitorname = topic+MONITOR_POSTFIX; 8 9 XmlRpc::XmlRpcValue params, result, payload; 10 params[0] = monitorname; 11 params[1] = topic; 12 params[2] = datatype; 13 string m_uri = ""; 14 params[3] = m_uri; 15 16 //create a xmlrpcmanager-client for each monitor 17 monitor_p = new Monitor(params,rv_ros_host, monitorname); 18 monitorMap[topic] = monitor_p; 19 m_uri = monitor_p->getMonitorXmlRpcUri(); 20 params[3] = m_uri; 21 22 bool f = master::execute("registerSubscriber",params,result,payload,true); 23 24 //start a new thread with the params 25 boost::thread(boost::bind(&Monitor::monitorThreadFunc, monitor_p)); 26 27 result[0]=1; 28 result[1]="Subscribed to ["+topic+"]"; 29 XmlRpc::XmlRpcValue pubs_monitor; 30 pubs_monitor[0] = m_uri; 31 result[2] = pubs_monitor; 32 33 ROS_INFO("Monitor %s successfully registered a subscriber to topic %s", monitorname.c_str(), topic.c_str()); 2 34 } </p>
        </blockquote>

        <h4 style="text-indent: 25px;">Topic remapping</h4>

        <p>
          Topic remapping. ROSMonitoring <a href="https://github.com/autonomy-and-verification-uol/ROSMonitoring"> (ROSMonitoring)</a>[4] utilizes topic remapping to ensure safety and security in the system by creating intermediary nodes via topic name remapping <a href="http://wiki.ros.org/roslaunch/XML/remap"> (roslaunch/remap)</a>. Remapping is a core tool from ROS that enables swapping topic names just before running the application. Remap, enables inserting an intermediary node between the other two original nodes. Listing 2 exemplifies the topic remapping-based MITM strategy applied by ROSMonitoring. The code snippet shows that the launch files are incremented with remap statements including the node names, original (‘from’) topic and new (‘to’) topic name. 
        </p>

        <p>Listing 2: Topic remapping-based MITM in ROSMonitoring.  </p>
        <blockquote>
        <p>
        1 def instrument_launch_files(nodes): 2 ... 3 for (name, package, topics) in launch_files[path]: 4 if node.get(’name’) == name and node.get(’pkg’) == package: 5 for topic in topics: 6 remap = ET.SubElement(node, ’remap’) 7 remap.set(’from’, topic) 8 remap.set(’to’, topic + ’_mon’) 9 break </p>
        </blockquote>


        <p class="strengths" style="text-indent: 25px;">Strengths:</p>
        <p>The MITM strategy enables freezing of the application at the software level without the normal operation, and
          rollback in case the test scenarios are prone to side-effects and do not require any change in the code.</p>


        <p class="weaknesses" style="text-indent: 25px;">Weaknesses:</p>
        <p>Placing nodes between computations may cause performance overhead in the system under scrutiny. In addition,
          erroneous intermediary nodes may affect the functionality of the system, and thus represent a threat to the
          test's reliability. This guideline does not directly apply to server-based or parameter-based communication.
        </p>

        <p class="" style="text-indent: 25px;"> References </p> 
        <blockquote>


          <p>[1] A. Bertolino, P. Braione et al., “A survey of field-based testing techniques,” ACM Computing Surveys (CSUR), vol. 54, no. 5, pp. 1–39, 2021. </p>
          <p>[2] Y. Falcone, S. Krsti´c et al., “A taxonomy for classifying runtime verification tools,” International Journal on Software Tools for Technology Transfer, vol. 23, no. 2, pp. 255–284, 2021. 3 </p>
            <p>[3] J. Huang, C. Erdogan et al., “Rosrv: Runtime verification for robots,” in International Conference on Runtime Verification. Springer, 2014, pp. 247–254. </p>
              <p>[4] A. Ferrando, R. C. Cardoso et al., “Rosmonitoring: a runtime verification framework for ros,” in Annual Conference Towards Autonomous Robotic Systems. Springer, 2020, pp. 387–399. </p>
        <blockquote>

        

          <!-- ---------------------------------- GUIDELINE CONTENT END ---------------------------------- -->


        </div>

      </div>

      <footer class="post-footer clearfix">


        <div class="share">




        </div>

  </div>
  <footer class="footer">
    <div class="container">
      <div class="site-title-wrapper">
        <h1 class="site-title">
                    <a title="ROS-RVFT: GUIDELINES FOR DEVELOPERS AND QA TEAMS" href="index.html">ROS-RVFT: GUIDELINES FOR DEVELOPERS AND QA TEAMS</a>
        </h1>

      </div>

      <p class="footer-copyright">
        <span>Ricardo Caldas, Juan Antonio Pinera Garcia, Matei Schiopu,
          Patrizio Pelliccione, Genaina Rodrigues, and Thorsten Berger © 2024 </span>
      </p>
      <p class="footer-copyright">


      </p>
    </div>
  </footer>

  <script src="../files/jquery-1.11.3.min.js.download"></script>
  <script src="../files/jquery.fitvids.js.download"></script>
  <script src="../files/highlight.min.js.download"></script>
  <script src="../files/scripts.js.download"></script>


</body>

</html>